<!DOCTYPE html>

<html>
<head>
	<link rel='stylesheet' type='text/css' media='all' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css' />
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
	<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
	<style>
		.ng-hide { display: none; }
	</style>
</head>

<body ng-app="catalog" class="ng-hide" ng-controller="CatalogController as Catalog" ng-cloak ng-show="true">
	<div id="header">
		<ul class="nav nav-pills">
			<li ng-click="view='addons'" ng-class="{ active: view == 'addons' }"><a>Add-ons</a></li>
			<li ng-click="view='discover'" ng-class="{ active: view == 'discover' }"><a>Discover</a></li>
			<li ng-click="view='search'" ng-class="{ active: view == 'search' }"><a>Search</a></li>

		</ul>
	</div>

	<div id="discover" ng-show="view=='discover'">
		<div class="row">
			<div class="col-xs-2">
				<ul class="nav nav-pills nav-stacked cat-types">
					<li ng-repeat="(key, val) in Catalog.catTypes" ng-class="{'active': selected.type === key}"><a href="" ng-click="selected.type = key">{{val.name}}</a></li>
				</ul>
				<br>
				<ul class="nav nav-pills nav-stacked cat-genres">
					<li ng-class="{'active': !selected.genre}"><a href="" ng-click="selected.genre = null">Top</a></li>
					<li ng-repeat="(genre, _) in Catalog.genres[selected.type]" ng-class="{'active': selected.genre === genre}"><a href="" ng-click="selected.genre = genre">{{genre}}</a></li>
				</ul>
			</div>
			<div class="col-xs-7">
				<div class="row catalog" ng-show="Catalog.items">
					<div ng-repeat="res in Catalog.items" ng-if="res.poster" class="col-xs-4 col-lg-3 nopadding" >
						<div class="panel" ng-class="res.id == selected.item.id ? 'panel-primary' : ''">
							<a href="" ng-click="selected.item = res">
								<img class="img-responsive" ng-src="{{formatImgURL(res.poster, 210, 300) || 'no-poster.jpg'}}" alt="{{res.name}}" />
							</a>
							<a ng-cloak class="play-button" href="#" ng-click="Catalog.playMovie(res)" ng-show="res.id == selected.item.id">
								<img src="play_circle.png" alt="Play"/>
							</a>
						</div>
					</div>
				</div>
				<div ng-show="isLoading()">
					<p><i class="fa fa-cog fa-spin"></i> Loading...</p>
				</div>
				<div ng-hide="Catalog.items.length || isLoading()">
					<p>No items to display</p>
				</div>
			</div>
			<div class="col-xs-3" ng-show="selected.item">
				<div class="panel panel-default movie-info affix">
					<div class="panel-body" style="position: relative; font-size: 13px;">
						<h2 class="text-uppercase"> {{selected.item.name}}</h2>
						<ul class="list-inline">
							<li ng-repeat-start="(id, genre) in selected.item.genre" ng-show="id" role="separator">|</li>
							<li ng-repeat-end>{{genre}}</li>
						</ul>
						<table class="table table-borderless">
							<tr>
								<th ng-show="selected.item.imdbRating" class="text-uppercase">IMDB</th>
								<th ng-show="selected.item.year" class="text-uppercase">Year</th>
								<th ng-show="selected.item.director" class="text-uppercase">Director</th>
							</tr>
							<tr class="sidebar-values">
								<td ng-if="selected.item.imdbRating">
									{{selected.item.imdbRating}}
								</td>
								<td ng-if="selected.item.year">{{selected.item.year}}</td>
								<td ng-if="selected.item.director">
									{{selected.item.director.join(', ')}}
								</td>
							</tr>
						</table>
						<h3 class="text-uppercase" ng-if="selected.item.cast">Lead actors</h3>
						<p>{{selected.item.cast.join(', ')}}</p>
						<h3 class="text-uppercase" ng-if="selected.item.description">Summary</h3>
						<p>{{selected.item.description}}</p>

						<table class="table table-borderless">
							<tr><td ng-show="selected.item.uploads || selected.item.episodes">
								<select ng-model="selected.video" ng-options="item as getVidName(item) for item in (selected.item.uploads || selected.item.episodes)"></select>
							</td></tr>
						</table>

						<h3 class="text-uppercase" ng-if="handle.candidates">Streams</h3>
						<table class="table table-borderless" ng-repeat="stream in handle.candidates">
							<tr>

								<td>
									<!-- stream name - usually the add-on name -->
									<div>{{streamName(stream)}}</div>

									<!-- stream title ; if it's pay-per-watch, then this will contain the price -->
									<div>{{stream.title}}</div>

									<!-- if it's a free stream, subscription stream, etc. -->
									<div ng-if="stream.hasOwnProperty('isSubscription') || stream.hasOwnProperty('isFree')">{{stream.isSubscription ? 'subscription' : (stream.isFree ? 'free' : '')}}</div>

									<!-- tags: like sd, hd, low, 1080p, 4k; could contain source too, like netflix, hulu -->
									<div class='tags'>Tags: {{stream.tag.join(", ")}}</div>

									<!-- various type sof links to the stream; video link, external link, youtube link, bittorrent link -->
									<div class="link" ng-show="stream.url"><a target="_blank" ng-href="{{stream.url}}">video link to {{stream.url.split("/")[2]}}</a></div>

									<div class="link" ng-show="stream.externalUrl"><a target="_blank" ng-href="{{stream.externalUrl}}">external link to {{stream.externalUrl.split("/")[2]}}</a></div>

									<div class="link" ng-show="stream.yt_id"><a target="_blank" ng-href="http://youtube.com/watch?v={{stream.yt_id}}">link to YouTube</a></div>

									<div class="link" ng-show="stream.infoHash"><a target="_blank" ng-href="magnet:?xt=urn:btih:{{stream.infoHash}}">bittorrent link to {{stream.infoHash}} {{stream.hasOwnProperty('mapIdx') ? ' / '+stream.mapIdx : ''}}</a></div>

								</td>

							</tr>

						</table>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
	<script src="/js/stremio-addons.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.min.js"></script>
	<script src="/js/eventemitter.js"></script>
	<script src="/catalog.js"></script>
	<link href="./style.css" rel="stylesheet" type="text/css" />

</body>
</html>
